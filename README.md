[![Contributor Covenant](https://img.shields.io/badge/Contributor%20Covenant-2.1-4baaaa.svg)](CODE_OF_CONDUCT.md)

# Capture-mark-recapture analyses associated with mountain yellow-legged frog recovery efforts

## Authors of this repository

Roland A. Knapp (roland.knapp(at)ucsb.edu) [![ORCiD](https://img.shields.io/badge/ORCiD-0000--0002--1954--2745-green.svg)](http://orcid.org/0000-0002-1954-2745)

Thomas C. Smith (tcsmith(at)ucsb.edu [![ORCiD](https://img.shields.io/badge/ORCiD-0000--0001--7908--438X-green.svg)](http://orcid.org/0000-0001-7908-438X)

## Overview of contents

This repository is organized as a reproducible research compendium, and focuses on actions conducted to recover populations of the endangered [mountain yellow-legged frog](https://www.fws.gov/sites/default/files/documents/Mountain-Yellow-Legged-Frog-Conservation-Strategy.pdf).
Specifically, it contains data from capture-mark-recapture (CMR) surveys conducted on translocated, reintroduced, and donor populations (e.g., [Joseph and Knapp 2018](https://doi.org/10.1002/ecs2.2499)), the code to analyze the survey data using [R](https://www.r-project.org/), and a notebook that summarizes the results-to-date for each population.
Results from many of these analyses are included in a manuscript (in preparation) that describes the establishment dynamics of frog populations following translocations.
Throughout this repository, frog populations are referenced only by 5-digit unique site identifiers.
No site names or x-y coordinates are provided to protect these sensitive populations to the maximum extent possible.

This repository contains the following directories and files:

-   `code/` directory: `Rmd` files that create datasets for each site (`xxxxx_createdata_mrmr.Rmd`), and analyze these data using the [mrmr](https://github.com/SNARL1/mrmr) package (`xxxx_analysis_mrmr.Rmd`) to describe frog survival, recruitment, and population size. Raw data used by the `createdata` files are not provided (see description of the `data/` directory for more information). As such, the `createdata` files are provided to be as transparent as possible about how the data were processed.
-   `data/` directory: Cleaned data that are error-checked and formatted for use in analyses. Raw data are not provided because information in some fields could reveal the locations of these sensitive frog populations. See the README file in this directory for a description of the data files.
-   `doc/` directory: Notebook file that describes the current status of each frog population at which CMR surveys are conducted, based on analysis results. 
-   `out/` directory:
    -   `plots/` directory: Plots displaying frog survival, adult frog abundance, and frog recruitment. These plots are also provided in the notebook in the `doc/notebook` directory.
    -   `model/` directory: Model fit `Rds` files.
    -   `notebooks_code/`: Html-rendered "notebooks" of all `xxxxx_createdata_mrmr.Rmd` and `xxxxx_analysis_mrmr.Rmd` files and their associated outputs. 
    -   `tables/` directory: `csv` files describing the survival of translocated frogs, by cohort and by individual.

Numerous files are included in the repository that can be generated by the code (e.g., notebooks, plots).
This is done to make these files available to users who may be unable to run the code.

## Reproducing the analyses

### Hardware requirements

Most of the `xxxxx_analysis_mrmr.Rmd` files can be run on a computer with 32 GB of RAM and at least four physical CPU cores.
The exception is `70550_analysis_mrmr.Rmd` that, due to the large number of frogs included in the associated datasets, requires 256 GB of RAM.
Using 16 cores and 256 GB of RAM, the run time for `70550_analysis_mrmr.Rmd` is approximately 6 hours.
Run times for all other `xxxxx_analysis_mrmr.Rmd` files, using 8 cores and 32 GB of RAM, are typically 5-30 minutes.

### Software requirements

We ran the analyses using [R](https://www.r-project.org/) and the R packages listed in the DESCRIPTION file.
All of the packages are available via the CRAN repository except [cmdstanr](https://mc-stan.org/cmdstanr/#installation) and [mrmr](https://snarl1.github.io/mrmr/index.html).
An installation of [cmdstan](https://mc-stan.org/cmdstanr/#installation) is also required.

We used the following R version and OS:

-   R version 4.1.2 (2021-11-01)
-   Platform: x86_64-pc-linux-gnu (64-bit)
-   Running under: Ubuntu 20.04.3 LTS

### Interactive session in a web browser

As an alternative to a local installation of this repository (via `git clone`), the software requirements have been wrapped in a Docker image (see Dockerfile for source code).
This allows viewing and interacting with the research compendium in a web browser window, with only minimal installation locally of software.

To start an interactive session, follow these steps:

1.  [Install Docker](https://docs.docker.com/get-docker/), if not already installed.  
2.  Start the Docker container for this research compendium (Linux users will need to preface the command with `sudo`):

``` bash
docker run -e PASSWORD=yourpasswordhere --rm -p 8787:8787 rolandknapp/cmr-analysis
```

This will launch an RStudio server on port 8787.
"yourpasswordhere" is a password of your choice that will be used to access the RStudio server (step 3).

1.  Navigate to <http://localhost:8787/>. In the login window, username = "rstudio" and password = password you specified in step 2.
2.  In the RStudio server, create a new project and clone the cmr-analysis repository into it ([as in this example](https://book.cds101.com/using-rstudio-server-to-clone-a-github-repo-as-a-new-project.html)). You are now able to run any of the code in the repository - all of the dependencies are already installed.  
3.  When done working with the repository in the browser window, log out of the RStudio server (File \> Sign Out). Close the Docker container running in Terminal with `ctrl-c`. If there are any files from your work in the container that you want to preserve (e.g., plots), save them to your local computer. Any unsaved files will be lost when the container is closed.

## Notebooks

Notebooks are available in the [doc/](https://github.com/SNARL1/cmr-analysis/tree/main/doc#readme) and [out/notebooks_code/](https://github.com/SNARL1/cmr-analysis/tree/main/out/notebooks_code#readme) directories. Links are to README files that describe how to view notebooks directly from GitHub. The `doc/` notebook provides summaries of results from CMR analyses for each of the study populations. The `out/notebooks_code/` notebooks are rendered directly from the `xxxxx_createdata_mrmr" and `xxxxx_createdata_mrmr` Rmd files, and describe dataset creation/data analysis steps for each population. 

## Contact

Roland Knapp, Research Biologist, University of California Sierra Nevada Aquatic Research Laboratory, Mammoth Lakes, CA 93546 USA; rolandknapp(at)ucsb.edu, <https://mountainlakesresearch.com/roland-knapp/>
